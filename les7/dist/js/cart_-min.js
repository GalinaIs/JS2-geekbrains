var Star=function(t){var e,a,r;if(this.starString="",/\./.test(t)){for(this.starString="",r=parseInt(t),e=0;e<r;e++)this.starString+='<i class="fa fa-star" aria-hidden="true"></i>';for(this.starString+='<i class="fa fa-star-half-o" aria-hidden="true"></i>',a=4-r,e=0;e<a;e++)this.starString+='<i class="fa fa-star-o" aria-hidden="true"></i>'}else{for(this.starString="",r=parseInt(t),e=0;e<r;e++)this.starString+='<i class="fa fa-star" aria-hidden="true"></i>';for(a=5-r,e=0;e<a;e++)this.starString+='<i class="fa fa-star-o" aria-hidden="true"></i>'}},Cart=function(t=""){this.pathHtml=t,this.renderCart()};Cart.prototype.renderCart=function(){$.ajax({url:"http://localhost:3000/cart",context:this,dataType:"json",success:function(t){var e,a=$("#product_cart");a.empty();var r=0,i=0,o=this;t.forEach(function(t){$(".template_cart .cart_product img").attr("src",o.pathHtml+t.path_img),$(".template_cart .cart_member_label p").html(t.name),$(".template_cart .cart_member_label span").html(t.quantity+"  x   $"+t.cost),$(".template_cart .cart_product").attr("data-id",t.id),$(".template_cart .cart_product").attr("data-quantity",t.quantity),r+=+t.quantity*+t.cost,i+=+t.quantity;var s=new Star(t.range);$(".template_cart .div_star").html(s.starString),(e=$(".template_cart").clone()).removeClass("template_cart"),a.append(e)}),$(".button_delete").on("click",function(t){o.deleteElement(t),t.preventDefault()}),$("div .elipse_card").html(i),$("div .total_price p").eq(1).html("$"+r)}})},Cart.prototype.deleteElement=function(t){var e=$(t.currentTarget).parent().children().attr("data-id");$(t.currentTarget).parent().children().attr("data-quantity")>1?$.ajax({type:"PATCH",url:"http://localhost:3000/cart/"+e,context:this,data:{quantity:$(t.currentTarget).parent().children().attr("data-quantity")-1},success:function(){this.renderCart()}}):$.ajax({type:"DELETE",url:"http://localhost:3000/cart/"+e,context:this,success:function(){this.renderCart()}})};var Feedback=function(){$("#feedback1").addClass("display_flex_fb"),$("#fb_div_flex a:first").addClass("active_fb_div_member"),$("#fb_div_flex").on("click","a",function(t){$(".active_fb_div_member").removeClass("active_fb_div_member"),$(this).addClass("active_fb_div_member"),$(".display_flex_fb").removeClass("display_flex_fb"),$($(this).attr("href")).addClass("display_flex_fb"),t.preventDefault()})};$(document).ready(function(){new Feedback});var Product=function(t,e,a,r="",i="",o=""){this.pathHtml=r,this.cart=t,this.initSettingForSearch(o),this.idElementPagesProduct=i,this.idChooseAll=e,this.idElementForHide=a;var s=this;$("#"+this.idChooseAll).on("click",function(t){s.renderProduct(0,1,!0),$("#"+s.idChooseAll).addClass("opacity_yes"),""!==s.idElementForHide&&$("#"+s.idElementForHide).addClass("opacity_yes"),t.preventDefault()})};Product.prototype.initSettingForSearch=function(t){this.settingForSearch={idCategory:"",category:[],brand:[],designer:[],size:[],trend:"",price:{upPrice:"",toPrice:""},sortBy:t}},Product.prototype.set=function(t,e){switch(e){case"idCategory":this.setIdCategory(t);break;case"category":this.setCategory(t);break;case"brand":this.setBrand(t);break;case"designer":this.setDesigner(t);break;case"size":this.setSize(t);break;case"trend":this.setTrend(t);break;case"price":this.setPrice(t);break;case"valueSortBy":this.setValueSortBy(t)}},Product.prototype.setIdCategory=function(t){this.settingForSearch.idCategory=t},Product.prototype.setCategory=function(t){this.settingForSearch.category.push(t)},Product.prototype.setBrand=function(t){this.settingForSearch.brand.push(t)},Product.prototype.setDesigner=function(t){this.settingForSearch.designer.push(t)},Product.prototype.setSize=function(t){this.settingForSearch.size.push(t)},Product.prototype.setTrend=function(t){this.settingForSearch.trend=t},Product.prototype.setPrice=function(t){this.settingForSearch.price.upPrice=t[0],this.settingForSearch.price.toPrice=t[1]},Product.prototype.setValueSortBy=function(t){this.settingForSearch.sortBy=t},Product.prototype.delete=function(t,e){switch(e){case"category":this.deleteCategory(t);break;case"brand":this.deleteBrand(t);break;case"designer":this.deleteDesigner(t);break;case"size":this.deleteSize(t)}},Product.prototype.deleteElementFromArray=function(t,e){var a=t.indexOf(e);t.splice(a,1)},Product.prototype.deleteCategory=function(t){this.deleteElementFromArray(this.settingForSearch.category,t)},Product.prototype.deleteBrand=function(t){this.deleteElementFromArray(this.settingForSearch.brand,t)},Product.prototype.deleteDesigner=function(t){this.deleteElementFromArray(this.settingForSearch.designer,t)},Product.prototype.deleteSize=function(t){this.deleteElementFromArray(this.settingForSearch.size,t)},Product.prototype.equalElement=function(t,e){return""===t||e.includes(t)},Product.prototype.equalArray=function(t,e){return 0===t.length||e.some(e=>t.includes(e))},Product.prototype.equalPrice=function(t,e){return""===t.upPrice||""===t.toPrice||t.upPrice<=e&&e<=t.toPrice},Product.prototype.sortByValue=function(t){switch(this.settingForSearch.sortBy){case"Name":return t.sort(function(t,e){return t.name>e.name});case"Cost":return t.sort(function(t,e){return+t.cost>+e.cost});case"Range":return t.sort(function(t,e){return+t.range>+e.range});default:return t}},Product.prototype.getItemForPrint=function(t){for(var e=[],a=0;a<t.length;a++)this.equalElement(this.settingForSearch.idCategory,t[a].id_category)&&this.equalArray(this.settingForSearch.category,t[a].category_name)&&this.equalArray(this.settingForSearch.brand,t[a].brand)&&this.equalArray(this.settingForSearch.designer,t[a].designer)&&this.equalArray(this.settingForSearch.size,t[a].size)&&this.equalElement(this.settingForSearch.trend,t[a].trend)&&this.equalPrice(this.settingForSearch.price,+t[a].cost)&&e.push(t[a]);return console.log(this.sortByValue(e)),this.sortByValue(e)},Product.prototype.renderOnePage=function(t,e,a){var r,i=$(".preview_menu_flex");i.empty();for(var o=(a-1)*e;o<a*e&&!(o>=t.length);o++){$(".template .img_prod").attr("src",this.pathHtml+t[o].path_img),$(".template .unit_name").html(t[o].name),$(".template .unit_cost").html("$"+t[o].cost),$(".template .button_to_card").attr("data-id",t[o].id);var s=new Star(t[o].range);$(".template .div_star").html(s.starString),(r=$(".template").clone()).removeClass("template"),i.append(r)}},Product.prototype.hideNextPreviousPage=function(t,e){$("#page_previous").removeClass("opacity_yes"),$("#page_next").removeClass("opacity_yes"),1===t&&$("#page_previous").addClass("opacity_yes"),t===e&&$("#page_next").addClass("opacity_yes")},Product.prototype.handlerDivPage=function(){var t=this;$(".ref_page").on("click",function(e){$(".href_active").removeClass("href_active"),$(this).addClass("href_active"),t.renderProduct(+$("#count_item_man select").val(),+$(this).html()),t.hideNextPreviousPage(+$(this).html(),$(".class_bottom_preview .ref_page").length),e.preventDefault()}),$("#page_previous").on("click","i",function(e){var a=+$(".href_active").html();a>1&&($(".href_active").removeClass("href_active"),$(".class_bottom_preview .ref_page").eq(a-2).addClass("href_active"),t.renderProduct(+$("#count_item_man select").val(),a-1),t.hideNextPreviousPage(a-1,$(".class_bottom_preview .ref_page").length)),e.preventDefault()}),$("#page_next").on("click","i",function(){var e=+$(".href_active").html(),a=$(".class_bottom_preview .ref_page").length;e<a&&($(".href_active").removeClass("href_active"),$(".class_bottom_preview .ref_page").eq(e).addClass("href_active"),t.renderProduct(+$("#count_item_man select").val(),e+1),t.hideNextPreviousPage(e+1,a)),event.preventDefault()})},Product.prototype.fillNumberPage=function(t,e){var a=$("#"+this.idElementPagesProduct);a.empty(),a.append('<a id="page_previous" href="#"><i class="fa fa-chevron-left"aria-hidden="true"></i></a>');for(var r=1;r<=t;r++)a.append($("<a />",{href:"#",text:r,class:"ref_page"}));a.append('<a id="page_next" href="#"><i class="fa fa-chevron-right"aria-hidden="true"></i></a>'),$("#"+this.idElementPagesProduct+" .ref_page").eq(e-1).addClass("href_active"),this.hideNextPreviousPage(e,$(".class_bottom_preview .ref_page").length),this.handlerDivPage()},Product.prototype.renderProduct=function(t,e=1,a=!1){$.ajax({url:"http://localhost:3000/product",context:this,dataType:"json",success:function(r){var i,o=this.getItemForPrint(r);console.log(o),i=a?o.length:t<o.length?t:o.length,this.renderOnePage(o,i,e);var s=this;$("div .button_to_card").on("click",function(t){s.addToCartDialog(t),t.preventDefault()}),""===this.idElementPagesProduct||a||this.fillNumberPage(Math.ceil(o.length/t),e),a||($("#"+this.idChooseAll).removeClass("opacity_yes"),""!==this.idElementForHide&&$("#"+this.idElementForHide).removeClass("opacity_yes"))}})},Product.prototype.createSelect=function(t,e){for(var a=$("#"+t+" select"),r=0;r<e.length;r++)a.append($("<option />",{value:e[r],text:e[r]}))},Product.prototype.addToCartDialog=function(t){var e=$(t.currentTarget).attr("data-id"),a=this;$.ajax({url:"http://localhost:3000/product/"+e,dataType:"json",context:this,success:function(t){$dialogCart=$("#dialog_cart"),$dialogCart.empty(),$dialogCart.append($("<img />",{src:this.pathHtml+t.path_img})),$dialogCart.append($("<h4 />",{text:t.name})),$dialogCart.append($("<div />",{id:"dialog_size_item"}).append($("<span />",{text:"Choose size: "})).append($("<select />"))),this.createSelect("dialog_size_item",t.size),$dialogCart.append($("<div />",{id:"dialog_color_item"}).append($("<span />",{text:"Choose color: "})).append($("<select />"))),this.createSelect("dialog_color_item",t.color),$dialogCart.dialog({modal:!0,title:"Choose for add to cart",buttons:{"Add to cart":function(){a.addToCart(e,$("#dialog_size_item select").val(),$("#dialog_color_item select").val()),$(this).dialog("close")},Close:function(){$(this).dialog("close")}}})}})},Product.prototype.addToCart=function(t,e,a){$.ajax({url:"http://localhost:3000/product/"+t,dataType:"json",context:this,success:function(t){var r={id:t.id,path_img:t.path_img,name:t.name,cost:t.cost,id_category:t.id_category,range:t.range,quantity:"1",color:a,size:e};$('#product_cart .cart_product[data-id="'+r.id+'"]').length?$.ajax({type:"PATCH",context:this,url:"http://localhost:3000/cart/"+r.id,data:{quantity:+$('#product_cart .cart_product[data-id="'+r.id+'"]').attr("data-quantity")+1},success:function(){this.cart.renderCart()}}):$.ajax({type:"POST",url:"http://localhost:3000/cart",context:this,data:r,success:function(){this.cart.renderCart()}})}})};var CartTable=function(t,e=""){this.cart=t,this.pathHtml=e,this.renderTableCart()};CartTable.prototype.renderTableCart=function(){$.ajax({url:"http://localhost:3000/cart",context:this,dataType:"json",success:function(t){var e,a=$("#table_cart");a.empty(),a.append($("#header_card"));var r=0;console.log(t);for(var i=0;i<t.length;i++)$(".tr_template_cart img").attr("src",this.pathHtml+t[i].path_img),$(".tr_template_cart h4").html(t[i].name),$(".tr_template_cart .cost").html("$"+ +t[i].cost),$(".tr_template_cart input").val(t[i].quantity),$(".tr_template_cart .item_total_price").html("$"+t[i].cost*+t[i].quantity),$(".tr_template_cart .delete_button a").attr("data-id",t[i].id),$(".tr_template_cart .count_td").attr("data-id",t[i].id),$(".tr_template_cart .color_item").html(t[i].color),$(".tr_template_cart .size_item").html(t[i].size),r+=+t[i].cost*+t[i].quantity,e=$(".tr_template_cart").clone(),console.log(e),e.removeClass("tr_template_cart"),a.append(e);$(".grand_total").html("$"+r),$(".sub_total").html("$"+r);var o=this;$(".delete_button").on("click","a",function(t){o.deleteElement(t),t.preventDefault()}),0===t.length?($("#clear_cart").addClass("opacity_yes"),a.addClass("opacity_yes"),$(".cart_is_empty").removeClass("opacity_yes")):($("#clear_cart").removeClass("opacity_yes"),a.removeClass("opacity_yes"),$(".cart_is_empty").addClass("opacity_yes")),$(".count_td").change(function(){o.changeCountItem(event)})}})},CartTable.prototype.changeCountItem=function(t){var e=$(t.currentTarget).attr("data-id");$.ajax({type:"PATCH",context:this,url:"http://localhost:3000/cart/"+e,data:{quantity:$(t.currentTarget).val()},success:function(){this.renderTableCart("../"),this.cart.renderCart()}})},CartTable.prototype.deleteElement=function(t){var e=$(t.currentTarget).parent().children().attr("data-id");$.ajax({type:"DELETE",context:this,url:"http://localhost:3000/cart/"+e,success:function(){this.renderTableCart("../"),this.cart.renderCart()}})},CartTable.prototype.clearAllCart=function(){$.ajax({url:"http://localhost:3000/cart",context:this,success:function(t){for(var e=0;e<t.length;e++)$.ajax({type:"DELETE",context:this,url:"http://localhost:3000/cart/"+t[e].id,success:function(){this.renderTableCart("../"),this.cart.renderCart()}})}})},$(document).ready(function(){var t=new Cart("../");new CartTable(t,"../");$("#clear_cart").on("click",function(t){clearAllCart(),t.preventDefault()})});